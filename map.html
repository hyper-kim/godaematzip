<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>Map</title>
    <style>body, html, #map { margin: 0; padding: 0; width: 100%; height: 100%; }</style>
    
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=xbuguzitkj"></script>
</head>
<body>
<div id="map"></div>
<script>
    // 에러 발생 시 화면에 표시하는 디버깅용 코드
    window.onerror = function(msg, url, line) {
        document.body.innerHTML = '<div style="padding:20px; color:red; font-weight:bold;">' + 
                                  '<h3>지도 로딩 실패!</h3>' + 
                                  '네이버 콘솔에 아래 주소가 등록되지 않았습니다:<br>' + 
                                  '[ ' + window.location.origin + ' ]<br><br>' +
                                  '에러 내용: ' + msg + '</div>';
    };

    if (typeof naver === 'undefined') {
        // 스크립트 자체가 차단된 경우
        document.body.innerHTML = '<div style="padding:20px; color:red;">네이버 지도 API를 불러오지 못했습니다.<br>새로고침 하거나 주소 등록을 확인해주세요.</div>';
    } else {
        const urlParams = new URLSearchParams(window.location.search);
        const lat = parseFloat(urlParams.get('lat')) || 37.5894;
        const lng = parseFloat(urlParams.get('lng')) || 127.0323;
        const markersParam = urlParams.get('markers');

        var mapOptions = { center: new naver.maps.LatLng(lat, lng), zoom: 17 };
        var map = new naver.maps.Map('map', mapOptions);

        if (markersParam) {
            try {
                const markerList = JSON.parse(decodeURIComponent(markersParam));
                markerList.forEach(function(store) {
                    if (store.lat && store.lng) {
                        var marker = new naver.maps.Marker({
                            position: new naver.maps.LatLng(store.lat, store.lng),
                            map: map,
                            title: store.name
                        });
                    }
                });
            } catch (e) { console.error(e); }
        }
    }
</script>
</body>
</html>
